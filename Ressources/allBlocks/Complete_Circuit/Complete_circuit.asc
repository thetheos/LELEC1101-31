Version 4
SHEET 1 3620 2148
WIRE -3344 224 -3376 224
WIRE -3248 224 -3280 224
WIRE -144 224 -192 224
WIRE -32 224 -64 224
WIRE -448 288 -464 288
WIRE -336 288 -368 288
WIRE -320 288 -336 288
WIRE -336 304 -336 288
WIRE -2560 320 -2592 320
WIRE -320 320 -320 288
WIRE -192 320 -192 224
WIRE -192 320 -320 320
WIRE -176 320 -192 320
WIRE -3376 336 -3376 224
WIRE -3344 336 -3376 336
WIRE -3248 336 -3248 224
WIRE -3248 336 -3264 336
WIRE -2288 336 -2496 336
WIRE -32 336 -32 224
WIRE -32 336 -112 336
WIRE 64 336 -32 336
WIRE -4592 352 -4864 352
WIRE -2560 352 -2656 352
WIRE -240 352 -320 352
WIRE -176 352 -240 352
WIRE 656 352 640 352
WIRE 800 352 736 352
WIRE -4496 368 -4496 336
WIRE -4432 368 -4496 368
WIRE -4304 368 -4368 368
WIRE -448 368 -464 368
WIRE -320 368 -320 352
WIRE -320 368 -368 368
WIRE 496 368 432 368
WIRE 592 368 576 368
WIRE -4496 400 -4496 368
WIRE -4304 400 -4304 368
WIRE -4864 416 -4864 352
WIRE -3744 448 -3776 448
WIRE -3568 448 -3664 448
WIRE -3376 448 -3376 336
WIRE -3376 448 -3504 448
WIRE -3344 448 -3376 448
WIRE -4592 464 -4592 352
WIRE -4544 464 -4592 464
WIRE -3248 464 -3248 336
WIRE -3248 464 -3280 464
WIRE -3104 464 -3248 464
WIRE -3344 480 -3376 480
WIRE 592 480 592 368
WIRE 640 480 640 352
WIRE 640 480 592 480
WIRE 656 480 640 480
WIRE -976 496 -1072 496
WIRE -832 496 -896 496
WIRE 800 496 800 352
WIRE 800 496 720 496
WIRE 656 512 640 512
WIRE 496 576 432 576
WIRE 592 576 592 480
WIRE 592 576 576 576
WIRE 640 576 640 512
WIRE -3376 592 -3376 480
WIRE 1424 592 1392 592
WIRE 1536 592 1504 592
WIRE 1632 592 1600 592
WIRE 1776 592 1696 592
WIRE -4864 608 -4864 496
WIRE -4496 608 -4496 496
WIRE -4496 608 -4864 608
WIRE -1072 608 -1072 496
WIRE -1072 608 -1168 608
WIRE -1008 608 -1072 608
WIRE 432 608 432 576
WIRE -2560 624 -2592 624
WIRE -832 624 -832 496
WIRE -832 624 -944 624
WIRE -752 624 -832 624
WIRE -4496 640 -4496 608
WIRE -2288 640 -2496 640
WIRE -1008 640 -1104 640
WIRE -2560 656 -2656 656
WIRE -160 688 -416 688
WIRE 1392 688 1392 592
WIRE 1440 688 1392 688
WIRE 1520 688 1504 688
WIRE 1664 688 1584 688
WIRE 1776 688 1776 592
WIRE 1776 688 1744 688
WIRE -1104 704 -1104 640
WIRE -1104 704 -1168 704
WIRE -160 720 -160 688
WIRE -3328 736 -3360 736
WIRE -3232 736 -3264 736
WIRE -416 784 -416 688
WIRE -416 784 -448 784
WIRE -384 784 -416 784
WIRE 1392 784 1392 688
WIRE 1472 784 1392 784
WIRE 1616 784 1536 784
WIRE 1616 832 1616 784
WIRE 1664 832 1616 832
WIRE 1776 832 1776 688
WIRE 1776 832 1744 832
WIRE 2016 832 1936 832
WIRE 2144 832 2096 832
WIRE -3360 848 -3360 736
WIRE -3328 848 -3360 848
WIRE -3232 848 -3232 736
WIRE -3232 848 -3248 848
WIRE -512 848 -512 784
WIRE -320 848 -320 784
WIRE -288 848 -320 848
WIRE -160 848 -160 800
WIRE -144 848 -160 848
WIRE -160 880 -160 848
WIRE 1392 880 1392 784
WIRE 1472 880 1392 880
WIRE 1616 880 1616 832
WIRE 1616 880 1536 880
WIRE -4592 912 -4864 912
WIRE -4496 928 -4496 896
WIRE -4432 928 -4496 928
WIRE -4304 928 -4368 928
WIRE -512 928 -512 848
WIRE -416 928 -448 928
WIRE -384 928 -416 928
WIRE -320 928 -320 848
WIRE -4496 960 -4496 928
WIRE -3728 960 -3776 960
WIRE -3552 960 -3648 960
WIRE -3360 960 -3360 848
WIRE -3360 960 -3488 960
WIRE -3328 960 -3360 960
WIRE 1392 960 1392 880
WIRE 1392 960 1360 960
WIRE 1568 960 1392 960
WIRE 1776 960 1776 832
WIRE 1776 960 1648 960
WIRE 1856 960 1776 960
WIRE -4864 976 -4864 912
WIRE -3232 976 -3232 848
WIRE -3232 976 -3264 976
WIRE -3088 976 -3232 976
WIRE -160 976 -160 944
WIRE -144 976 -160 976
WIRE 1856 976 1856 960
WIRE 1936 976 1936 832
WIRE 1936 976 1856 976
WIRE 1984 976 1936 976
WIRE -3328 992 -3360 992
WIRE 2144 992 2144 832
WIRE 2144 992 2048 992
WIRE 2208 992 2144 992
WIRE -416 1008 -416 928
WIRE -160 1008 -160 976
WIRE -160 1008 -416 1008
WIRE -4592 1024 -4592 912
WIRE -4544 1024 -4592 1024
WIRE -3360 1104 -3360 992
WIRE -4864 1168 -4864 1056
WIRE -4496 1168 -4496 1056
WIRE -4496 1168 -4864 1168
WIRE -4496 1200 -4496 1168
WIRE -2560 1200 -2608 1200
WIRE -2432 1200 -2480 1200
WIRE -2384 1200 -2432 1200
WIRE -2272 1200 -2304 1200
WIRE -2608 1248 -2608 1200
WIRE -2608 1248 -2736 1248
WIRE -2432 1264 -2432 1200
WIRE -2384 1264 -2432 1264
WIRE -2272 1280 -2272 1200
WIRE -2272 1280 -2320 1280
WIRE -2224 1280 -2272 1280
WIRE -2608 1296 -2608 1248
WIRE -2560 1296 -2608 1296
WIRE -2432 1296 -2480 1296
WIRE -2384 1296 -2432 1296
WIRE -2432 1344 -2432 1296
WIRE -2432 1440 -2432 1408
FLAG -2592 320 0
FLAG -976 592 V++
FLAG -1248 608 VS2
IOPIN -1248 608 In
FLAG -1248 704 VS1
IOPIN -1248 704 In
FLAG -1104 784 0
FLAG -2432 1440 0
FLAG -1824 -368 0
FLAG -1728 -368 0
FLAG -3376 592 0
FLAG -1824 -448 V++
IOPIN -1824 -448 Out
FLAG -1728 -448 V--
IOPIN -1728 -448 Out
FLAG -3312 496 V--
FLAG -3312 432 V++
FLAG -2864 -320 0
FLAG -2464 -320 0
FLAG -3360 1104 0
FLAG -3296 1008 V--
FLAG -3296 944 V++
FLAG -3104 464 VF1
IOPIN -3104 464 Out
FLAG -3088 976 VF2
IOPIN -3088 976 Out
FLAG -2528 304 V++
IOPIN -2528 304 In
FLAG -2528 368 V--
IOPIN -2528 368 In
FLAG -2656 352 VF1
IOPIN -2656 352 In
FLAG -2288 336 VS1
IOPIN -2288 336 Out
FLAG -2592 624 0
FLAG -2528 608 V++
IOPIN -2528 608 In
FLAG -2528 672 V--
IOPIN -2528 672 In
FLAG -2656 656 VDP2
IOPIN -2656 656 In
FLAG -2288 640 VS2
IOPIN -2288 640 Out
FLAG -2736 1248 VF2
IOPIN -2736 1248 In
FLAG -2224 1280 VDP2
IOPIN -2224 1280 Out
FLAG -752 624 VDiff
IOPIN -752 624 Out
FLAG -976 656 V--
FLAG -512 848 VDiff
IOPIN -512 848 In
FLAG -288 848 0
FLAG -144 368 V--
FLAG -144 304 V++
FLAG -240 432 0
FLAG 432 688 0
FLAG 640 576 0
FLAG 688 528 V--
FLAG 688 464 V++
FLAG 432 496 V++
IOPIN 432 496 In
FLAG -144 976 Vdir-
IOPIN -144 976 Out
FLAG -144 848 Vdir+
IOPIN -144 848 Out
FLAG -464 368 Vdir-
IOPIN -464 368 In
FLAG -464 288 Vdir+
IOPIN -464 288 In
FLAG 64 336 Vdirdiff
IOPIN 64 336 Out
FLAG 432 368 Vdirdiff
IOPIN 432 368 In
FLAG 800 496 OUT
IOPIN 800 496 Out
FLAG -4496 640 0
FLAG -4496 256 V++
FLAG -4496 1200 0
FLAG -4496 816 V++
FLAG -4304 368 IN1
IOPIN -4304 368 Out
FLAG -4304 928 IN2
IOPIN -4304 928 Out
FLAG -3776 960 IN2
IOPIN -3776 960 Out
FLAG -3776 448 IN1
IOPIN -3776 448 Out
FLAG 2016 960 V++
FLAG 2016 1024 V--
FLAG 1984 1008 0
FLAG 1360 960 OUT
IOPIN 1360 960 In
SYMBOL Opamps\\opamp2 -2528 272 R0
SYMATTR InstName U1
SYMATTR Value TL084
SYMBOL Opamps\\opamp2 -976 560 R0
SYMATTR InstName U2
SYMATTR Value TL084
SYMBOL res -1152 592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res -1152 688 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res -880 480 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 20k
SYMBOL res -1120 688 R0
SYMATTR InstName R4
SYMATTR Value 20k
SYMBOL Opamps\\opamp -2352 1216 R0
SYMATTR InstName U4
SYMATTR SpiceLine2 GBW=100Meg
SYMBOL cap -2448 1344 R0
SYMATTR InstName C2
SYMATTR Value {C}
SYMBOL res -2464 1280 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value {1/{2*pi*fo*C}}
SYMBOL res -2464 1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res -2288 1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL res -3248 320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL cap -3280 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 0.53n
SYMBOL cap -3504 432 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 15.9µ
SYMBOL res -3648 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL Opamps\\opamp2 -3312 400 R0
SYMATTR InstName U3
SYMATTR Value TL084
SYMBOL voltage -1824 -464 R0
SYMATTR InstName V8
SYMATTR Value 15
SYMBOL voltage -1728 -464 R0
SYMATTR InstName V9
SYMATTR Value -15
SYMBOL bv -2864 -416 R0
WINDOW 0 37 45 Left 2
SYMATTR InstName B1
SYMATTR Value V=(white(2e6*time)/10)
SYMBOL voltage -2864 -496 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value SINE(0 1 3000 0 0 -90)
SYMBOL voltage -2464 -496 R0
WINDOW 3 26 83 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value SINE(0 1 3000)
SYMATTR InstName V14
SYMBOL bv -2464 -416 R0
WINDOW 0 38 33 Left 2
SYMATTR InstName B2
SYMATTR Value V=(white(2e6*time)/10)
SYMBOL res -3232 832 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL cap -3264 720 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 0.53n
SYMBOL cap -3488 944 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 15.9µ
SYMBOL res -3632 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL Opamps\\opamp2 -3296 912 R0
SYMATTR InstName U5
SYMATTR Value TL084
SYMBOL Opamps\\opamp2 -2528 576 R0
SYMATTR InstName U6
SYMATTR Value TL084
SYMBOL cap -144 944 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C6
SYMATTR Value 1000n
SYMBOL diode -448 912 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode -512 800 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL diode -384 944 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL diode -320 768 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL Opamps\\opamp2 -144 272 R0
SYMATTR InstName U7
SYMATTR Value TL084
SYMBOL res -48 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 20k
SYMBOL res -352 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 10k
SYMBOL res -352 352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL res -256 336 R0
SYMATTR InstName R15
SYMATTR Value 20k
SYMBOL Opamps\\opamp2 688 432 R0
SYMATTR InstName U8
SYMATTR Value TL084
SYMBOL res 592 352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 10k
SYMBOL res 592 560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 10k
SYMBOL res 448 704 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R20
SYMATTR Value 100
SYMBOL res 448 592 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R21
SYMATTR Value 68.5
SYMBOL res 752 336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 3.8k
SYMBOL njf -4544 400 R0
SYMATTR InstName J1
SYMBOL res -4512 240 R0
SYMATTR InstName R13
SYMATTR Value 14k
SYMBOL voltage -4864 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value SINE(0 0.1 3000 0 0 90)
SYMBOL cap -4432 384 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C7
SYMATTR Value 2.2µ
SYMBOL njf -4544 960 R0
SYMATTR InstName J2
SYMBOL res -4512 800 R0
SYMATTR InstName R24
SYMATTR Value 14k
SYMBOL voltage -4864 960 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value SINE(0 0.1 3000 0 0 0)
SYMBOL cap -4432 944 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C8
SYMATTR Value 2.2µ
SYMBOL res -144 816 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R23
SYMATTR Value 20k
SYMBOL res 1664 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL res 1760 816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 64.64k
SYMBOL res 1760 672 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 4k
SYMBOL res 1520 576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R27
SYMATTR Value 4k
SYMBOL diode 1536 768 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D5
SYMBOL diode 1600 576 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D6
SYMBOL diode 1696 576 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D7
SYMBOL diode 1472 896 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D8
SYMBOL diode 1520 704 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D9
SYMBOL diode 1440 704 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D10
SYMBOL Opamps\\opamp2 2016 928 R0
SYMATTR InstName U9
SYMATTR Value TL084
SYMBOL res 2112 816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 62.5k
TEXT -2816 96 Left 2 ;Saturation comparator
TEXT -1440 128 Left 2 ;Differential Comparator
TEXT -2816 992 Left 2 ;pi half Phase shifter
TEXT -2744 1112 Left 2 !.param C=3.3n fo=3k
TEXT -2744 1080 Left 2 !.inc opamp.sub
TEXT -1440 -472 Left 2 !.include ../TL084.lib
TEXT -1440 -504 Left 2 !.tran 0 1 0 1m
TEXT -3904 112 Left 2 ;Filter
TEXT -2912 -608 Left 2 ;Mic. input
TEXT -1888 -560 Left 2 ;Opamp voltage
TEXT -568 544 Left 2 ;Rectifier and low pass filter
TEXT -576 128 Left 2 ;Differential amplifier
TEXT 288 272 Left 2 ;DC offset (sum op-amp)
TEXT -1472 48 Left 2 ;Direction and angle
TEXT -1432 1136 Left 2 ;Description:\nINPUT: Two square signals dephased of pi/2.\nOUTPUT: A DC voltage between [V--/2;V++/2] proportional to sin(phi) \n                (Phi is the phase difference between the two input signals)\n \nDetailed explanation:\nThe first differential amplifier substract the two input signals.\nThis output is rectified and goes straight to a low-pass filter to get the average (dc component)\nTo center the voltage around 0V (if DC < V++/2 then the voltage is negative\nThe differential voltage after the low pass filter go through a differential opamp to set voltage refference back to ground\nWe use a summing opamp. In wich we sum a constant dc offset via the voltage divider
TEXT -544 608 Left 2 ;Rectifier
TEXT -232 608 Left 2 ;Low pass filter
TEXT -1440 -440 Left 2 !.include ../LM311.301
TEXT -4976 144 Left 2 ;Micros
TEXT 1920 624 Left 2 ;1k 6.4k 220
RECTANGLE Normal -1568 896 -2816 128
RECTANGLE Normal -656 832 -1440 144
RECTANGLE Normal -1824 1520 -2816 1008
RECTANGLE Normal -1648 -272 -1888 -544
RECTANGLE Normal -2128 -272 -2912 -592
RECTANGLE Normal -2944 1184 -3904 128
RECTANGLE Normal -2976 1152 -3872 688 2
RECTANGLE Normal -2976 640 -3872 160 2
RECTANGLE Normal -2192 768 -2752 512 2
RECTANGLE Normal -2192 464 -2752 192 2
RECTANGLE Normal 112 1072 -576 560
RECTANGLE Normal 0 1040 -240 624 2
RECTANGLE Normal -544 1040 -256 624 2
RECTANGLE Normal 208 480 -576 144
RECTANGLE Normal 896 752 288 288
RECTANGLE Normal 992 1552 -1472 64 2
RECTANGLE Normal -4176 1376 -4976 160
