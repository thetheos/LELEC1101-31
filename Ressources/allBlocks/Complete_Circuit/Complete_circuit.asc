Version 4
SHEET 1 3620 2352
WIRE -1056 208 -1152 208
WIRE -912 208 -976 208
WIRE 624 208 608 208
WIRE 768 208 704 208
WIRE 464 224 400 224
WIRE 560 224 544 224
WIRE -3424 272 -3424 224
WIRE -3424 272 -3456 272
WIRE -3392 272 -3424 272
WIRE -3456 288 -3456 272
WIRE -3392 304 -3392 272
WIRE -3104 320 -3104 304
WIRE -3104 320 -3312 320
WIRE -2560 320 -2592 320
WIRE -1152 320 -1152 208
WIRE -1152 320 -1248 320
WIRE -1088 320 -1152 320
WIRE -3104 336 -3104 320
WIRE -2288 336 -2496 336
WIRE -912 336 -912 208
WIRE -912 336 -1024 336
WIRE -832 336 -912 336
WIRE 560 336 560 224
WIRE 608 336 608 208
WIRE 608 336 560 336
WIRE 624 336 608 336
WIRE -4592 352 -4864 352
WIRE -2560 352 -2656 352
WIRE -1088 352 -1184 352
WIRE 768 352 768 208
WIRE 768 352 688 352
WIRE -4496 368 -4496 336
WIRE -4432 368 -4496 368
WIRE -4304 368 -4368 368
WIRE 624 368 608 368
WIRE -3456 384 -3456 368
WIRE -3424 384 -3456 384
WIRE -3392 384 -3392 368
WIRE -3392 384 -3424 384
WIRE -4496 400 -4496 368
WIRE -4864 416 -4864 352
WIRE -1184 416 -1184 352
WIRE -1184 416 -1248 416
WIRE -3312 432 -3312 320
WIRE -3248 432 -3312 432
WIRE 464 432 400 432
WIRE 560 432 560 336
WIRE 560 432 544 432
WIRE 608 432 608 368
WIRE -3104 448 -3104 416
WIRE -3104 448 -3184 448
WIRE -3088 448 -3104 448
WIRE -4592 464 -4592 352
WIRE -4544 464 -4592 464
WIRE -3696 464 -3760 464
WIRE -3568 464 -3616 464
WIRE -3520 464 -3568 464
WIRE -3424 464 -3424 384
WIRE -3424 464 -3456 464
WIRE -3248 464 -3424 464
WIRE 400 464 400 432
WIRE -3568 544 -3568 464
WIRE -3408 544 -3568 544
WIRE -3104 544 -3104 448
WIRE -3104 544 -3328 544
WIRE -4864 608 -4864 496
WIRE -4496 608 -4496 496
WIRE -4496 608 -4864 608
WIRE -2560 624 -2592 624
WIRE -4496 640 -4496 608
WIRE -2288 640 -2496 640
WIRE -2560 656 -2656 656
WIRE -544 720 -544 688
WIRE -288 720 -464 720
WIRE -1120 768 -1184 768
WIRE -976 768 -1040 768
WIRE -768 768 -944 768
WIRE -768 784 -768 768
WIRE 256 784 224 784
WIRE 368 784 320 784
WIRE -3424 800 -3424 752
WIRE -3424 800 -3456 800
WIRE -3392 800 -3424 800
WIRE -480 800 -544 800
WIRE -464 800 -464 720
WIRE -432 800 -464 800
WIRE -3456 816 -3456 800
WIRE -288 816 -288 720
WIRE -288 816 -368 816
WIRE -3392 832 -3392 800
WIRE -944 832 -944 768
WIRE -896 832 -944 832
WIRE -544 832 -544 800
WIRE -480 832 -480 800
WIRE -432 832 -480 832
WIRE -416 832 -432 832
WIRE -3104 848 -3104 832
WIRE -3104 848 -3312 848
WIRE -1184 848 -1184 768
WIRE -1184 848 -1216 848
WIRE -1152 848 -1184 848
WIRE -768 848 -768 784
WIRE -768 848 -832 848
WIRE -3104 864 -3104 848
WIRE -1056 864 -1088 864
WIRE -976 864 -976 768
WIRE -976 864 -992 864
WIRE -896 864 -976 864
WIRE -1152 880 -1200 880
WIRE -4592 912 -4864 912
WIRE -3456 912 -3456 896
WIRE -3424 912 -3456 912
WIRE -3392 912 -3392 896
WIRE -3392 912 -3424 912
WIRE 144 912 144 784
WIRE 256 912 224 912
WIRE 368 912 320 912
WIRE 432 912 432 784
WIRE -4496 928 -4496 896
WIRE -4432 928 -4496 928
WIRE -4304 928 -4368 928
WIRE -1200 944 -1200 880
WIRE -4496 960 -4496 928
WIRE -3312 960 -3312 848
WIRE -3248 960 -3312 960
WIRE -4864 976 -4864 912
WIRE -3104 976 -3104 944
WIRE -3104 976 -3184 976
WIRE -3088 976 -3104 976
WIRE -3696 992 -3760 992
WIRE -3568 992 -3616 992
WIRE -3520 992 -3568 992
WIRE -3424 992 -3424 912
WIRE -3424 992 -3456 992
WIRE -3248 992 -3424 992
WIRE 432 992 432 912
WIRE 464 992 432 992
WIRE -544 1008 -544 896
WIRE -4592 1024 -4592 912
WIRE -4544 1024 -4592 1024
WIRE 144 1024 144 912
WIRE 256 1024 144 1024
WIRE -3568 1072 -3568 992
WIRE -3408 1072 -3568 1072
WIRE -3104 1072 -3104 976
WIRE -3104 1072 -3328 1072
WIRE 320 1072 320 1024
WIRE 368 1072 320 1072
WIRE 464 1072 464 992
WIRE 464 1072 448 1072
WIRE 592 1104 544 1104
WIRE 720 1104 672 1104
WIRE 144 1120 144 1024
WIRE 256 1120 144 1120
WIRE 320 1120 320 1072
WIRE -4864 1168 -4864 1056
WIRE -4496 1168 -4496 1056
WIRE -4496 1168 -4864 1168
WIRE -4496 1200 -4496 1168
WIRE -2560 1200 -2608 1200
WIRE -2432 1200 -2480 1200
WIRE -2384 1200 -2432 1200
WIRE -2272 1200 -2304 1200
WIRE 144 1232 144 1120
WIRE 256 1232 144 1232
WIRE 464 1232 464 1072
WIRE 464 1232 336 1232
WIRE 544 1232 544 1104
WIRE 544 1232 464 1232
WIRE 592 1232 544 1232
WIRE -2608 1248 -2608 1200
WIRE -2608 1248 -2736 1248
WIRE 720 1248 720 1104
WIRE 720 1248 656 1248
WIRE 768 1248 720 1248
WIRE -2432 1264 -2432 1200
WIRE -2384 1264 -2432 1264
WIRE 592 1264 560 1264
WIRE 608 1264 592 1264
WIRE -2272 1280 -2272 1200
WIRE -2272 1280 -2320 1280
WIRE -2224 1280 -2272 1280
WIRE -2608 1296 -2608 1248
WIRE -2560 1296 -2608 1296
WIRE -2432 1296 -2480 1296
WIRE -2384 1296 -2432 1296
WIRE 560 1296 560 1264
WIRE -2432 1344 -2432 1296
WIRE -2432 1440 -2432 1408
FLAG -2592 320 0
FLAG -1056 304 V++
FLAG -1328 320 VS2
IOPIN -1328 320 In
FLAG -1328 416 VS1
IOPIN -1328 416 In
FLAG -1184 496 0
FLAG -2432 1440 0
FLAG -1824 -368 0
FLAG -1728 -368 0
FLAG -1824 -448 V++
IOPIN -1824 -448 Out
FLAG -1728 -448 V--
IOPIN -1728 -448 Out
FLAG -2864 -320 0
FLAG -2464 -320 0
FLAG -2528 304 V++
IOPIN -2528 304 In
FLAG -2528 368 V--
IOPIN -2528 368 In
FLAG -2656 352 VF1
IOPIN -2656 352 In
FLAG -2288 336 VS1
IOPIN -2288 336 Out
FLAG -2592 624 0
FLAG -2528 608 V++
IOPIN -2528 608 In
FLAG -2528 672 V--
IOPIN -2528 672 In
FLAG -2656 656 VDP2
IOPIN -2656 656 In
FLAG -2288 640 VS2
IOPIN -2288 640 Out
FLAG -2736 1248 VF2
IOPIN -2736 1248 In
FLAG -2224 1280 VDP2
IOPIN -2224 1280 Out
FLAG -832 336 VDiff
IOPIN -832 336 Out
FLAG -1056 368 V--
FLAG 400 544 0
FLAG 608 432 0
FLAG 656 384 V--
FLAG 656 320 V++
FLAG 400 352 V--
IOPIN 400 352 In
FLAG 400 224 Vdirdiff
IOPIN 400 224 In
FLAG 768 352 VDCOFF
IOPIN 768 352 Out
FLAG -4496 640 0
FLAG -4496 256 V++
FLAG -4496 1200 0
FLAG -4496 816 V++
FLAG -2864 -480 IN1
FLAG -2464 -480 IN2
FLAG -400 784 V++
FLAG -400 848 V--
FLAG -288 816 Vdirdiff
IOPIN -288 816 Out
FLAG 624 1216 V++
FLAG 624 1280 V--
FLAG 560 1296 0
FLAG 144 1232 VDCOFF
IOPIN 144 1232 In
FLAG 768 1248 Vasin
IOPIN 768 1248 Out
FLAG -3424 224 0
FLAG -3104 224 0
FLAG -3216 416 V++
FLAG -3216 480 V--
FLAG -3760 464 IN2
IOPIN -3760 464 In
FLAG -3088 448 VF2
IOPIN -3088 448 Out
FLAG -3760 992 IN1
IOPIN -3760 992 In
FLAG -3088 976 VF1
IOPIN -3088 976 Out
FLAG -3424 752 0
FLAG -3104 752 0
FLAG -3216 944 V++
FLAG -3216 1008 V--
FLAG -1200 944 0
FLAG -864 816 V++
FLAG -1120 832 V++
FLAG -864 880 V--
FLAG -1120 896 V--
FLAG -544 1008 0
FLAG -768 784 Vlp
IOPIN -768 784 Out
FLAG -544 688 Vlp
IOPIN -544 688 In
FLAG -1296 848 VDiff
SYMBOL Opamps\\opamp2 -2528 272 R0
SYMATTR InstName U1
SYMATTR Value TL084
SYMBOL Opamps\\opamp2 -1056 272 R0
SYMATTR InstName U2
SYMATTR Value TL084
SYMBOL res -1232 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res -1232 400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res -960 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL res -1200 400 R0
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL Opamps\\opamp -2352 1216 R0
SYMATTR InstName U4
SYMATTR SpiceLine2 GBW=100Meg
SYMBOL cap -2448 1344 R0
SYMATTR InstName C2
SYMATTR Value {C}
SYMBOL res -2464 1280 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value {1/{2*pi*fo*C}}
SYMBOL res -2464 1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res -2288 1184 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL voltage -1824 -464 R0
SYMATTR InstName V8
SYMATTR Value 15
SYMBOL voltage -1728 -464 R0
SYMATTR InstName V9
SYMATTR Value -15
SYMBOL bv -2864 -416 R0
WINDOW 0 37 45 Left 2
SYMATTR InstName B1
SYMATTR Value V=(white(2e6*time)/10)
SYMBOL voltage -2864 -496 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value SINE(0 1 4000 0 0 0)
SYMBOL voltage -2464 -496 R0
WINDOW 3 26 83 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value SINE(0 1 4000 0 0 -70)
SYMATTR InstName V14
SYMBOL bv -2464 -416 R0
WINDOW 0 38 33 Left 2
SYMATTR InstName B2
SYMATTR Value V=(white(2e6*time)/10)
SYMBOL Opamps\\opamp2 -2528 576 R0
SYMATTR InstName U6
SYMATTR Value TL084
SYMBOL Opamps\\opamp2 656 288 R0
SYMATTR InstName U8
SYMATTR Value TL084
SYMBOL res 560 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 10k
SYMBOL res 560 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 10k
SYMBOL res 416 560 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res 416 448 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R21
SYMATTR Value 5k
SYMBOL res 720 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 1.866k
SYMBOL njf -4544 400 R0
SYMATTR InstName J1
SYMBOL res -4512 240 R0
SYMATTR InstName R13
SYMATTR Value 14k
SYMBOL voltage -4864 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value SINE(0 0.1 3000 0 0 -60)
SYMBOL cap -4432 384 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C7
SYMATTR Value 2.2�
SYMBOL njf -4544 960 R0
SYMATTR InstName J2
SYMBOL res -4512 800 R0
SYMATTR InstName R24
SYMATTR Value 14k
SYMBOL voltage -4864 960 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value SINE(0 0.1 3000 0 0 0)
SYMBOL cap -4432 944 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C8
SYMATTR Value 2.2�
SYMBOL Opamps\\opamp2 -400 752 R0
SYMATTR InstName U9
SYMATTR Value TL084
SYMBOL cap -560 832 R0
SYMATTR InstName C9
SYMATTR Value 1000n
SYMBOL res 352 1216 R90
WINDOW 0 -4 42 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 14k
SYMBOL diode 256 1136 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMBOL diode 320 1008 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D6
SYMATTR Value 1N4148
SYMBOL diode 256 928 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D7
SYMATTR Value 1N4148
SYMBOL diode 368 928 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D8
SYMATTR Value 1N4148
SYMBOL diode 320 768 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D9
SYMATTR Value 1N4148
SYMBOL diode 432 768 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D10
SYMATTR Value 1N4148
SYMBOL res 240 768 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R27
SYMATTR Value 10k
SYMBOL res 464 1056 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 33k
SYMBOL Opamps\\opamp2 624 1184 R0
SYMATTR InstName U10
SYMATTR Value TL084
SYMBOL res 688 1088 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value 75k
SYMBOL res -560 704 R0
SYMATTR InstName R7
SYMATTR Value 22k
SYMBOL Opamps\\opamp2 -3216 384 R0
SYMATTR InstName U11
SYMATTR Value TL084
SYMBOL res -3120 320 R0
SYMATTR InstName R25
SYMATTR Value 4k
SYMBOL res -3120 208 R0
SYMATTR InstName R30
SYMATTR Value 1.1k
SYMBOL res -3600 448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 5.1k
SYMBOL res -3312 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R32
SYMATTR Value 5.1k
SYMBOL cap -3456 448 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value 10n
SYMBOL res -3472 272 R0
WINDOW 0 -56 48 Left 2
WINDOW 3 -59 80 Left 2
SYMATTR InstName R33
SYMATTR Value 5.1k
SYMBOL cap -3408 304 R0
SYMATTR InstName C10
SYMATTR Value 10n
SYMBOL Opamps\\opamp2 -3216 912 R0
SYMATTR InstName U12
SYMATTR Value TL084
SYMBOL res -3120 848 R0
SYMATTR InstName R34
SYMATTR Value 4k
SYMBOL res -3120 736 R0
SYMATTR InstName R35
SYMATTR Value 1.1k
SYMBOL res -3600 976 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R36
SYMATTR Value 5.1k
SYMBOL res -3312 1056 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R37
SYMATTR Value 5.1k
SYMBOL cap -3456 976 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C11
SYMATTR Value 10n
SYMBOL res -3472 800 R0
WINDOW 0 -56 48 Left 2
WINDOW 3 -59 80 Left 2
SYMATTR InstName R38
SYMATTR Value 5.1k
SYMBOL cap -3408 832 R0
SYMATTR InstName C12
SYMATTR Value 10n
SYMBOL res 240 896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL res -1200 832 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 100k
SYMBOL Opamps\\opamp2 -1120 800 R0
SYMATTR InstName U3
SYMATTR Value TL084
SYMBOL res -1024 752 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL diode -1056 880 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D11
SYMBOL Opamps\\opamp2 -864 784 R0
SYMATTR InstName U5
SYMATTR Value TL084
TEXT -2816 96 Left 2 ;Saturation comparator
TEXT -1440 128 Left 2 ;Differential Amplifier
TEXT -2816 992 Left 2 ;pi half Phase shifter
TEXT -2744 1112 Left 2 !.param C=4.7n fo=4k
TEXT -2744 1080 Left 2 !.inc opamp.sub
TEXT -1440 -472 Left 2 !.include ../TL084.lib
TEXT -1440 -504 Left 2 !.tran 100m
TEXT -3904 112 Left 2 ;Filter
TEXT -2912 -608 Left 2 ;Mic. input
TEXT -1888 -560 Left 2 ;Opamp voltage
TEXT -1432 576 Left 2 ;Rectifier and low pass filter
TEXT 256 128 Left 2 ;DC offset (sum op-amp)
TEXT -1472 48 Left 2 ;Direction and angle
TEXT -1448 1232 Left 2 ;Description:\nINPUT: Two square signals dephased of pi/2.\nOUTPUT: A DC voltage between [V--/2;V++/2] proportional to sin(phi) \n                (Phi is the phase difference between the two input signals)\n \nDetailed explanation:\nThe first differential amplifier substract the two input signals.\nThis output is rectified and goes straight to a low-pass filter to get the average (dc component)\nTo center the voltage around 0V (if DC < V++/2 then the voltage is negative\nThe differential voltage after the low pass filter go through a differential opamp to set voltage refference back to ground\nWe use a summing opamp. In wich we sum a constant dc offset via the voltage divider
TEXT -1392 624 Left 2 ;Rectifier
TEXT -640 624 Left 2 ;Low pass filter
TEXT -1440 -440 Left 2 !.include ../LM311.301
TEXT -4976 144 Left 2 ;Micros
TEXT -5376 -680 Left 2 ;Emitter
TEXT -5344 -112 Left 2 ;Integrator
TEXT -4576 -104 Left 2 ;Schmitt trigger
TEXT -3944 -104 Left 2 ;Amplifier and Speaker
TEXT -5336 -8 Left 2 ;Oscillator
TEXT 16 688 Left 2 ;Arcsinus
LINE Normal -3984 -32 -5344 -32 2
LINE Normal -3984 -32 -3984 -32 2
LINE Normal -3984 -32 -3984 -32 2
LINE Normal -5344 -32 -3984 -32 2
LINE Normal -5344 -32 -5344 -32 2
LINE Normal -5344 -32 -5344 -32 2
LINE Normal -5344 -32 -5344 -32 2
LINE Normal -5344 -32 -5344 -32 2
LINE Normal -5344 -64 -5344 -32 2
LINE Normal -5344 -64 -5344 -64 2
LINE Normal -5344 -64 -5344 -64 2
LINE Normal -3984 -80 -3984 -32 2
RECTANGLE Normal -1824 1520 -2816 1008
RECTANGLE Normal -1648 -272 -1888 -544
RECTANGLE Normal -2128 -272 -2912 -592
RECTANGLE Normal -2944 1184 -3904 128
RECTANGLE Normal -2976 1152 -3872 688 2
RECTANGLE Normal -2976 640 -3872 160 2
RECTANGLE Normal -2192 768 -2752 512 2
RECTANGLE Normal -2192 464 -2752 192 2
RECTANGLE Normal 864 608 256 144
RECTANGLE Normal 992 1552 -1472 64 2
RECTANGLE Normal -4176 1376 -4976 160
RECTANGLE Normal -3200 64 -5392 -656
RECTANGLE Normal -4624 -128 -5344 -608 2
RECTANGLE Normal -3984 -128 -4576 -608 2
RECTANGLE Normal -3264 -128 -3952 -608 2
RECTANGLE Normal -2160 800 -2816 112
RECTANGLE Normal -720 544 -1440 144
RECTANGLE Normal -176 1120 -1440 592
RECTANGLE Normal 880 1344 16 704
RECTANGLE Normal -192 1040 -640 640 2
RECTANGLE Normal -656 1040 -1392 640 2
